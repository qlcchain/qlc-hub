syntax = "proto3";
package proto;
option go_package = ".;proto";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";

message PingResponse {
   string ethContract  = 1;
   string ethAddress   = 2;
   string neoContract  = 3;
   string neoAddress   = 4;
}

message DepositLockRequest{
   string nep5TxHash = 1;
   string rHash      = 2;
   string addr       = 3;
}

message FetchRequest{
   string rOrigin      = 1;
   string userNep5Addr = 2;
}

message ClaimRequest{
  string rOrigin        = 1;
  string userNep5Addr   = 2;
}

message EventResponse {
  int64  state      = 1;
  string stateStr   = 2;
  string rHash      = 3;
  string txHash     = 4;
}

message LockerStateResponse {
  int64  state        = 1;
  string stateStr     = 2;
  string rHash        = 3;
  string rOrigin      = 4;
  int64  amount       = 5;
  string lockedNeoHash       = 6;
  uint32 lockedNeoHeight     = 7;
  string lockedEthHash       = 8;
  uint32 lockedEthHeight     = 9;
  string unlockedNeoHash     = 10;
  uint32 unlockedNeoHeight   = 11;
  string unlockedEthHash     = 12;
  uint32 unlockedEthHeight   = 13;
  uint32 neoTimerInterval    = 14;
  uint32 ethTimerInterval    = 15;
  string startTime           = 16;
  string lastModifyTime      = 17;
  string neoUserAddr         = 18;
  string ethUserAddr         = 19;
  bool   neoTimeout          = 20;
  bool   ethTimeout          = 21;
  bool   fail                = 22;
  string remark              = 23;
}

message Offset {
    int32   count      = 1;
    int32   offset     = 2;
}

message ParamAndOffset {
    string  value      = 1;
    int32   count      = 2;
    int32   offset     = 3;
}

message LockerStatesResponse {
    repeated LockerStateResponse lockers = 1;
}


service DepositAPI {
    rpc Lock(DepositLockRequest) returns (Boolean){
        option (google.api.http) = {
          post: "/deposit/lock"
          body: "*"
        };
    }

    rpc Fetch(FetchRequest) returns (Boolean){
       option (google.api.http) = {
           post: "/deposit/fetch"
           body: "*"
        };
    }
}

service WithdrawAPI {
   rpc Claim(ClaimRequest) returns (Boolean){
       option (google.api.http) = {
         post: "/withdraw/claim"
         body: "*"
       };
    }
}

service EventAPI {
    rpc Event(google.protobuf.Empty) returns (stream EventResponse){
       option (google.api.http) = {
         get: "/event/state"
       };
    }
}

service InfoAPI {
    rpc Ping(google.protobuf.Empty) returns (PingResponse){
        option (google.api.http) = {
          get: "/info/ping"
        };
    }

    rpc LockerInfo(String) returns (LockerStateResponse){
        option (google.api.http) = {
          get: "/info/lockerInfo"
        };
    }

    rpc LockerInfosByErc20Addr(ParamAndOffset) returns (LockerStatesResponse){
        option (google.api.http) = {
          get: "/info/lockerInfosByErc20Addr"
        };
    }

    rpc LockerInfosByNep5Addr(ParamAndOffset) returns (LockerStatesResponse){
        option (google.api.http) = {
          get: "/info/lockerInfosByNep5Addr"
        };
    }

    rpc LockerInfos(Offset) returns (LockerStatesResponse){
        option (google.api.http) = {
          get: "/info/lockerInfos"
        };
    }
}

message lockerInfosCountResponse  {
    map<string, int32> counts = 1;
}

message HashTimerResponse  {
    string rHash          = 1;
    string rOrigin        = 2;
    int64  amount         = 3;
    string userAddr       = 4;
    uint32 lockedHeight   = 5;
    uint32 unlockedHeight = 6;
}

service DebugAPI {
    rpc HashTimer(String) returns (HashTimerResponse){
        option (google.api.http) = {
          get: "/debug/hashTimer"
        };
    }

    rpc LockerInfosCount(google.protobuf.Empty) returns (lockerInfosCountResponse){
        option (google.api.http) = {
          get: "/debug/lockerInfosCount"
        };
    }

    rpc LockerInfosByState(ParamAndOffset) returns (LockerStatesResponse){
        option (google.api.http) = {
          get: "/debug/lockerInfosByState"
        };
    }
}

message Boolean {
    bool value = 1;
}

message String {
    string value = 1;
}
